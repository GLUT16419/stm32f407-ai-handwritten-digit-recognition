# STM32手写数字识别串口通信实现计划

## 项目现状分析
- **硬件平台**：STM32F407开发板
- **开发环境**：STM32CubeMX + HAL库
- **AI模型**：mnist_ultralight_model（28x28手写数字识别）
- **串口配置**：USART1已初始化（115200波特率，8N1）
- **当前状态**：串口已配置但无通信逻辑，AI模型已集成但未与串口数据关联

## 实现计划

### 1. 串口通信基础配置
- **修改文件**：`Core/Inc/main.h`
- **实现内容**：
  - 定义串口缓冲区大小和帧格式
  - 声明全局变量（接收缓冲区、状态标志等）

### 2. 串口中断接收功能
- **修改文件**：`Core/Src/main.c`
- **实现内容**：
  - 实现`HAL_UART_RxCpltCallback`中断回调函数
  - 实现接收缓冲区管理和帧尾检测
  - 开启串口中断接收

### 3. 数据处理与格式转换
- **修改文件**：`Core/Src/main.c`
- **实现内容**：
  - 实现`PictureCharArrayToFloat`函数（uint8_t转float）
  - 实现数据校验和提取逻辑

### 4. 串口发送功能
- **修改文件**：`Core/Src/main.c`
- **实现内容**：
  - 实现`Uart_send`函数（字符串发送）
  - 实现识别结果格式化和发送逻辑

### 5. AI推理集成
- **修改文件**：`Core/Src/main.c`
- **实现内容**：
  - 修改主循环，集成数据接收→AI推理→结果发送的完整流程
  - 实现推理结果的处理和概率最大值提取

### 6. 系统初始化与配置
- **修改文件**：`Core/Src/main.c`
- **实现内容**：
  - 在`main`函数中初始化串口接收
  - 配置AI模型初始化

## 技术要点

### 通信协议
- **波特率**：115200
- **数据格式**：8位数据位，1位停止位，无校验
- **帧格式**：1字节帧头 + 784字节数据 + 2字节帧尾（含`\n`）
- **接收方式**：中断接收，`\n`作为帧结束标志

### 数据处理
- **上位机→单片机**：28x28像素数据（784字节，0-255）
- **格式转换**：uint8_t → float（直接赋值，可选择归一化）
- **单片机→上位机**：0-9概率值 + 最终识别结果

### AI模型使用
- **输入**：784个float值（28x28像素）
- **输出**：10个float值（0-9概率）
- **推理函数**：使用CubeAI生成的API

## 预期功能
- 上位机发送手写数字数据
- 单片机接收并进行AI推理
- 单片机返回识别结果
- 实现完整的手写数字识别闭环系统